failtoban configuration
-----------------------

- sudo apt update
- sudo apt upgrade
- sudo apt autoremove -y
- sudo apt install fail2ban
- cd /etc/failt2ban 
- sudo cp fail2ban.conf fail2ban.local
- sudo nano fail2ban
    now add
            [sshd]
            enabled = true
            port = 549(ssh custom port)
            filter  = sshd
            logpath = /var/log/auth.log
            maxretry = 3
            bantime = -1
- sudo service fail2ban restart
- sudo fail2ban-client status

-you got output 
- Number of jail: 1
- jail list: sshd

-sudo fail2ban-client status list
status for the jail: sshd
-Filter
- currently failed: 0
- total failed: 0
- file list: /var/log/auth.log
- 
now once you do ssh.. you ip will add in banned ip list

-sudo fail2ban-client status sshd
 status for the jail:ssd
 -filter
    -currently failed:0
    -tolal failed:0
    -file list:/var/log.auth.log
- Actions
    -currentl banned:1
    -total banned:1
    -Banned IP list: ssh ip that try to hit ssh port...

command to check the ban status
--------------------------------

- sudo fail2ban-client status sshd
- sudo fail2ban-client status   --- gives you all ban status..


what is fail2ban
----------------

- Fail2ban is an intrusion prevention framework written in python that protects linux system and server from brute-force attacks.
- it allows you to monitor the strength and frequency of attacks.
- Fail2ban can be setup to block IP addresses automatically based onn specific parameters..
- 
step to configuration
---------------------
- sudo apt-get update
- apt-get install fail2ban
- systemctl enable fail2ban.service
- systemctl start fail2ban.service

configuration file of fail2ban
------------------------------

- ls -al /etc/fail2ban
 
    important file like jail.conf and fail2ban.cong

jail.conf
---------

In most of the cases you should not modify this file, but provide coutomization in jail.local file, or saparate.conf file under jail.d/ directory.

cp jail.conf jail.local
or vi jail.local

    [sshd]
    enable = true/fasle     :enable true mean, fail or pertection is enable or enable fasle mean disable..
    port = ssh              :give the port 
    filter = sshd           :mean fail2ban i want you to look is perticular filter
    logpath = /var/log/auth.log          
    maxretry = 3             :no of attempt before ipaddress/user will be ban. security options
    bantime =      8600          :this is a time in sec that ip address will be ban for   : 1hour=3600sec*24=86400
    ignoreip = 127.0.0.1 or other ip which you want to whitelist from this process.
    
    save and exit.
    
    
- remember do test this through proxychange ip. otherwise it will base your own ip..
    now once you do ssh with 3 time wrong password attemps it will ban you.. 
    you can check how is ban in jail with "fail2ban-client status or fail2ban-client status sshd"
    
    
    test command with hydra: 
    hydra -l root -P /usr/share/wordlists/metasploit/common roots.txt ssh://ipaddress -I -v
    
- for disable: 
    go to jail.local file and trun enable to false.. and restart service.
    

fail2ban jails
--------------

- ssh server   by-default we are banning ssh. not to give access to other..
- HTTP server -apache , nginx , php
- web application server
- HTTP Proxy server
- FTP server
- Mail server
- DNS server
- Miscellaneous
- mysql
- mongodb
- 
change in jail.local file lines
-------------------------------
- line54  ignoreip =  127.0.0.1/8::1 <add ipaddress here>  your ip address will not ignore in this process.
- line63   bantime = <give ban time here>
- line70   maxretry = <allow maximun attempts here>
-


unban ip
-------

you can do this with failtoban client like:

    fail2ban-client set sshd unbanip <ipaddress>
